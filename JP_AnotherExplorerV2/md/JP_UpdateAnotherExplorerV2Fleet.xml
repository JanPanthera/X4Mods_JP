<?xml version="1.0" encoding="utf-8" ?>

<mdscript name="JP_UpdateAnotherExplorerV2Fleet_MD" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
  <cues>

    <cue name="JP_UPDATE_ANOTHER_EXPLORER_V2_FLEET" instantiate="true" checkinterval="2s">
      <conditions>
        <check_value value="global.$AnotherExplorerV2Ships? and @global.$AnotherExplorerV2Ships.count gt 1"/>
      </conditions>
      <actions>

        <set_value name="$DEBUG" exact="false"/>
        
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <do_if value="$DEBUG">
          <set_value name="$DebugScriptName" exact="'JP_UPDATE_ANOTHER_EXPLORER_V2_FLEET'"/>
          <set_value name="$DebugFolderName" exact="'JP_AnotherExplorerV2.logs'"/>
          <set_value name="$DebugFileName" exact="this.ship.idcode + '.' + $DebugScriptName + '.xml.log'"/>
          <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
        </do_if>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_for_each name="$_AutoFleetShip" in="global.$AnotherExplorerV2Ships">
          <do_if value="$_AutoFleetShip.defaultorder.$IS_FLEET_LEADER and $_AutoFleetShip.defaultorder.$AUTOMATIC_FLEET">
            <set_value name="$_AutoFleetShipLeader" exact="$_AutoFleetShip"/>
            <continue/>
          </do_if>
        </do_for_each>

        <do_if value="$_AutoFleetShipLeader?">
          <do_for_each name="$_AutoFleetShip" in="global.$AnotherExplorerV2Ships" counter="$_it">
            <do_if value="not $_AutoFleetShip.defaultorder.$AUTOMATIC_FLEET">
              <continue/>
            </do_if>
            <do_if value="$_AutoFleetShip != $_AutoFleetShipLeader and $_AutoFleetShip.commander == null">
              <set_object_commander object="$_AutoFleetShip" commander="$_AutoFleetShipLeader"/>
              <continue/>
            </do_if>
            <do_if value="$_AutoFleetShip == $_AutoFleetShipLeader and $_AutoFleetShip.fleet.name != ''">
              <set_value name="$_ColorString" exact="if @global.$AEV2_AFCS then global.$AEV2_AFCS else ''"/>
              <do_if value="$_AutoFleetShip.fleet.name != (if $_ColorString == '' then 'AnotherExplorerV2' else $_ColorString + 'AnotherExplorerV2' + '\033X')">
                <set_object_fleet_name object="$_AutoFleetShip" name="if $_ColorString != '' then $_ColorString + 'AnotherExplorerV2' + '\033X' else 'AnotherExplorerV2'"/>
              </do_if>
              <remove_value name="$_ColorString"/>
              <continue/>
            </do_if>
          </do_for_each>
        </do_if>

        <do_if value="$_AutoFleetShipLeader?">
          <remove_value name="$_AutoFleetShipLeader"/>
        </do_if>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
          <remove_value name="$DebugFileName"/>
          <remove_value name="$DebugFolderName"/>
          <remove_value name="$DebugScriptName"/>
        </do_if>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        
        <remove_value name="$DEBUG"/>

      </actions>
    </cue>

    <cue name="JP_ANOTHER_EXPLORER_V2_DEBUG" instantiate="true" checkinterval="1s">
      <actions>

        <set_value name="$DEBUG" exact="false"/>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <do_if value="$DEBUG">
          <set_value name="$DebugScriptName" exact="'JP_ANOTHER_EXPLORER_V2_DEBUG'"/>
          <set_value name="$DebugFolderName" exact="'JP_AnotherExplorerV2.logs'"/>
          <set_value name="$DebugFileName" exact="this.ship.idcode + '.' + $DebugScriptName + '.xml.log'"/>
          <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
        </do_if>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'global.$AnotherExplorerV2SectorBlackList'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <do_if value="global.$AnotherExplorerV2SectorBlackList?">
            <do_for_each name="$_Sector" in="@global.$AnotherExplorerV2SectorBlackList">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Sector: %1 ~~ [%2].'.[@$_Sector.knownname, @$_Sector.owner.knownname]"/>
            </do_for_each>
          </do_if>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'global.$AnotherExplorerV2Ships'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <do_if value="global.$AnotherExplorerV2Ships?">
            <do_for_each name="$_Ship" in="@global.$AnotherExplorerV2Ships">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Ship: %1 [%2] ~~ [%3].'.[@$_Ship.knownname, @$_Ship.idcode, @$_Ship.owner.knownname]"/>
            </do_for_each>
          </do_if>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
        </do_if>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
          <remove_value name="$DebugFileName"/>
          <remove_value name="$DebugFolderName"/>
          <remove_value name="$DebugScriptName"/>
        </do_if>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        
        <remove_value name="$DEBUG"/>

      </actions>
    </cue>

  </cues>
</mdscript>