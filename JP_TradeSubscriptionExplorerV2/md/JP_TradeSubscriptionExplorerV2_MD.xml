<?xml version="1.0" encoding="utf-8" ?>

<mdscript name="JP_TradeSubscriptionExplorerV2_MD" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
  <cues>

    <!-- DEBUG off before changing to: checkinterval="1ms" !!! -->
    <cue name="JP_TSEV2_Root_MD" instantiate="true" checkinterval="1s">
      <actions>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <set_value name="$DEBUG" exact="0"/>
        <do_if value="$DEBUG gt 0">
          <set_value name="$DebugScriptName" exact="'JP_TSEV2_Root_MD'"/>
          <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
          <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
          <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
        </do_if>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_if value="global.$TradeSubscriptionExplorerV2S_Settings? and @global.$TradeSubscriptionExplorerV2S_Settings.count != 13">
          <remove_value name="global.$TradeSubscriptionExplorerV2S_Settings"/>
        </do_if>

        <do_if value="global.$TradeSubscriptionExplorerV2G_Settings? and @global.$TradeSubscriptionExplorerV2G_Settings.count != 13">
          <remove_value name="global.$TradeSubscriptionExplorerV2G_Settings"/>
        </do_if>

        <do_if value="not global.$TradeSubscriptionExplorerV2Ships_Table?">
          <set_value name="global.$TradeSubscriptionExplorerV2Ships_Table" exact="table[]"/>
        </do_if>

        <do_if value="not global.$TradeSubscriptionExplorerV2Blacklist_List?">
          <create_list name="global.$TradeSubscriptionExplorerV2Blacklist_List"/>
        </do_if>

        <find_object name="$FoundPlayerShips" space="player.galaxy" owner="faction.player" multiple="true">
          <match class="class.ship"/>
          <match unit="false"/>
        </find_object>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <do_if value="$DEBUG gt 0">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
          <remove_value name="$DebugFileName"/>
          <remove_value name="$DebugFolderName"/>
          <remove_value name="$DebugScriptName"/>
        </do_if>
        <remove_value name="$DEBUG"/>
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

      </actions>
      <cues>

        <!-- JP_TSEV2_Debug_MD -->
        <cue name="JP_TSEV2_Debug_MD" instantiate="false">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Debug_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="$DEBUG gt 0">

              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'@$FoundPlayerShips.count: ' + @$FoundPlayerShips.count"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <do_if value="@$FoundPlayerShips.count gt 0 and $DEBUG gt 50">
                <do_for_each name="$_FoundShip" in="$FoundPlayerShips">
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Ship: %1 [%2] ~~ [%3].'.[@$_FoundShip.knownname, @$_FoundShip.idcode, @$_FoundShip.owner.knownname]"/>
                </do_for_each>
              </do_if>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'@global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count: ' + @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <do_if value="@global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
                <do_for_each name="$_FoundShip" valuename="$_BlacklistedObject" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Ship: %1 [%2] ~~ [%3].'.[@$_FoundShip.knownname, @$_FoundShip.idcode, @$_FoundShip.owner.knownname]"/>
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ $_BlacklistedObject: %1 [%2] ~~ [%3].'.[@$_BlacklistedObject.knownname, @$_BlacklistedObject.idcode, @$_BlacklistedObject.owner.knownname]"/>
                </do_for_each>
              </do_if>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'@global.$TradeSubscriptionExplorerV2Blacklist_List.count: ' + @global.$TradeSubscriptionExplorerV2Blacklist_List.count"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <do_if value="@global.$TradeSubscriptionExplorerV2Blacklist_List.count gt 0">
                <do_for_each name="$_FoundEntry" in="global.$TradeSubscriptionExplorerV2Blacklist_List">
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Ship: %1 [%2] ~~ [%3].'.[@$_FoundEntry.knownname, @$_FoundEntry.idcode, @$_FoundEntry.owner.knownname]"/>
                </do_for_each>
              </do_if>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'@global.$TradeSubscriptionExplorerV2S_Settings.count: ' + @global.$TradeSubscriptionExplorerV2S_Settings.count"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <do_if value="global.$TradeSubscriptionExplorerV2S_Settings?">
                <do_for_each name="$_Entry" in="global.$TradeSubscriptionExplorerV2S_Settings">
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="' ~ ' + $_Entry"/>
                </do_for_each>
              </do_if>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'@global.$TradeSubscriptionExplorerV2G_Settings.count: ' + @global.$TradeSubscriptionExplorerV2G_Settings.count"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <do_if value="global.$TradeSubscriptionExplorerV2G_Settings?">
                <do_for_each name="$_Entry" in="global.$TradeSubscriptionExplorerV2G_Settings">
                  <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="' ~ ' + $_Entry"/>
                </do_for_each>
              </do_if>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_Saved_Settings_MD -->
        <cue name="JP_TSEV2_Manage_Saved_Settings_MD">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_Saved_Settings_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="@global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$_TradeSubscriptionExplorerV2Ship" in="global.$TradeSubscriptionExplorerV2Ships_Table">

                <!-- $_TradeSubscriptionExplorerV2Ship.$SAVE_ORDER_SETTINGS -->
                <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.$SAVE_ORDER_SETTINGS">
                  <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.id == 'JP_TradeSubscriptionExplorerV2G'">
                    <create_list name="$_SettingsList"/>
                    <append_list_elements name="$_SettingsList" other="[
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG
                            ]"/>
                    <do_if value="not global.$TradeSubscriptionExplorerV2G_Settings?">
                      <create_list name="global.$TradeSubscriptionExplorerV2G_Settings"/>
                      <append_list_elements name="global.$TradeSubscriptionExplorerV2G_Settings" other="$_SettingsList"/>
                    </do_if>
                    <do_else>
                      <do_for_each name="$_Setting" in="global.$TradeSubscriptionExplorerV2G_Settings" counter="$_it">
                        <do_if value="$_Setting != $_SettingsList.{$_it}">
                          <set_value name="global.$TradeSubscriptionExplorerV2G_Settings.{$_it}" exact="$_SettingsList.{$_it}"/>
                        </do_if>
                      </do_for_each>
                    </do_else>
                    <remove_value name="$_SettingsList"/>
                    <show_help duration="5s" allowclose="true" log="true" custom="'JP_TradeSubscriptionExplorerV2G' + ' ~\n' + $_TradeSubscriptionExplorerV2Ship.knownname + ' [' + $_TradeSubscriptionExplorerV2Ship.idcode + ']\n\n' + '{8888888, 1995}'"/>
                    <cancel_all_orders object="$_TradeSubscriptionExplorerV2Ship"/>
                    <cancel_order order="$_TradeSubscriptionExplorerV2Ship.defaultorder"/>
                  </do_if>
                  <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.id == 'JP_TradeSubscriptionExplorerV2S'">
                    <create_list name="$_SettingsList"/>
                    <append_list_elements name="$_SettingsList" other="[
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION,
                            $_TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG
                            ]"/>
                    <do_if value="not global.$TradeSubscriptionExplorerV2S_Settings?">
                      <create_list name="global.$TradeSubscriptionExplorerV2S_Settings"/>
                      <append_list_elements name="global.$TradeSubscriptionExplorerV2S_Settings" other="$_SettingsList"/>
                    </do_if>
                    <do_else>
                      <do_for_each name="$_Setting" in="global.$TradeSubscriptionExplorerV2S_Settings" counter="$_it">
                        <do_if value="$_Setting != $_SettingsList.{$_it}">
                          <set_value name="global.$TradeSubscriptionExplorerV2S_Settings.{$_it}" exact="$_SettingsList.{$_it}"/>
                        </do_if>
                      </do_for_each>
                    </do_else>
                    <remove_value name="$_SettingsList"/>
                    <show_help duration="5s" allowclose="true" log="true" custom="'JP_TradeSubscriptionExplorerV2S' + ' ~\n' + $_TradeSubscriptionExplorerV2Ship.knownname + ' [' + $_TradeSubscriptionExplorerV2Ship.idcode + ']\n\n' + '{8888888, 1995}'"/>
                    <cancel_all_orders object="$_TradeSubscriptionExplorerV2Ship"/>
                    <cancel_order order="$_TradeSubscriptionExplorerV2Ship.defaultorder"/>
                  </do_if>
                </do_if>

                <!-- $_TradeSubscriptionExplorerV2Ship.$RESET_ORDER_SETTINGS -->
                <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.$RESET_ORDER_SETTINGS">
                  <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.id == 'JP_TradeSubscriptionExplorerV2G'">
                    <do_if value="global.$TradeSubscriptionExplorerV2G_Settings?">
                      <remove_value name="global.$TradeSubscriptionExplorerV2G_Settings"/>
                    </do_if>
                    <show_help duration="5s" allowclose="true" log="true" custom="'JP_TradeSubscriptionExplorerV2G' + ' ~\n' + $_TradeSubscriptionExplorerV2Ship.knownname + ' [' + $_TradeSubscriptionExplorerV2Ship.idcode + ']\n\n' + '{8888888, 1996}'"/>
                    <cancel_all_orders object="$_TradeSubscriptionExplorerV2Ship"/>
                    <cancel_order order="$_TradeSubscriptionExplorerV2Ship.defaultorder"/>
                  </do_if>
                  <do_if value="@$_TradeSubscriptionExplorerV2Ship.defaultorder.id == 'JP_TradeSubscriptionExplorerV2S'">
                    <do_if value="global.$TradeSubscriptionExplorerV2S_Settings?">
                      <remove_value name="global.$TradeSubscriptionExplorerV2S_Settings"/>
                    </do_if>
                    <show_help duration="5s" allowclose="true" log="true" custom="'JP_TradeSubscriptionExplorerV2S' + ' ~\n' + $_TradeSubscriptionExplorerV2Ship.knownname + ' [' + $_TradeSubscriptionExplorerV2Ship.idcode + ']\n\n' + '{8888888, 1996}'"/>
                    <cancel_all_orders object="$_TradeSubscriptionExplorerV2Ship"/>
                    <cancel_order order="$_TradeSubscriptionExplorerV2Ship.defaultorder"/>
                  </do_if>
                </do_if>

              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Handle_TSEV2ShipsList_Table_MD -->
        <cue name="JP_TSEV2_Handle_TSEV2ShipsList_Table_MD">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Handle_TSEV2ShipsList_Table_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="@$FoundPlayerShips.count gt 0 and global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count ge 0">
              <do_for_each name="$_FoundPlayerShip" in="$FoundPlayerShips">
                <do_if value="not global.$TradeSubscriptionExplorerV2Ships_Table.{$_FoundPlayerShip}?">
                  <do_if value="(['JP_TradeSubscriptionExplorerV2G','JP_TradeSubscriptionExplorerV2S'].indexof.{@$_FoundPlayerShip.defaultorder.id})">
                    <set_value name="global.$TradeSubscriptionExplorerV2Ships_Table.{$_FoundPlayerShip}" exact="null"/>
                  </do_if>
                </do_if>
              </do_for_each>
            </do_if>

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$TradeSubscriptionExplorerV2Ship" in="global.$TradeSubscriptionExplorerV2Ships_Table" reverse="true">
                <do_if value="not (['JP_TradeSubscriptionExplorerV2G','JP_TradeSubscriptionExplorerV2S'].indexof.{@$TradeSubscriptionExplorerV2Ship.defaultorder.id}) or $TradeSubscriptionExplorerV2Ship.iswreck or not $TradeSubscriptionExplorerV2Ship.isoperational">
                  <remove_value name="global.$TradeSubscriptionExplorerV2Ships_Table.{$TradeSubscriptionExplorerV2Ship}"/>
                </do_if>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_AddOrderTag_MD -->
        <cue name="JP_TSEV2_Manage_AddOrderTag_MD">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_AddOrderTag_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$_TradeSubscriptionExplorerV2Ship" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                <do_if value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG">
                  <do_if value="$_TradeSubscriptionExplorerV2Ship.defaultorder.id == 'JP_TradeSubscriptionExplorerV2G'">
                    <set_value name="$_OrderTag" exact="if $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION == 0 then '#TSEV2-G ' else ' #TSEV2-G'"/>
                  </do_if>
                  <do_else>
                    <set_value name="$_OrderTag" exact="if $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION == 0 then '#TSEV2-S ' else ' #TSEV2-S'"/>
                  </do_else>
                  <substitute_text source="$_TradeSubscriptionExplorerV2Ship.knownname" text="$_ResultName">
                    <replace string="('\033#FFA95908#' + $_OrderTag + '\033X')" with="''"/>
                  </substitute_text>
                  <do_if value="$_TradeSubscriptionExplorerV2Ship.knownname == $_ResultName">
                    <set_object_name object="$_TradeSubscriptionExplorerV2Ship" name="(if $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION == 0 then ('\033#FFA95908#' + $_OrderTag + '\033X') else '') + $_TradeSubscriptionExplorerV2Ship.knownname + (if $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION == 1 then ('\033#FFA95908#' + $_OrderTag + '\033X') else '')"/>
                  </do_if>
                  <remove_value name="$_OrderTag"/>
                </do_if>
              </do_for_each>
            </do_if>

            <create_list name="$_FoundPlayerShips"/>
            <find_object name="$_FoundPlayerShips" space="player.galaxy" owner="faction.player" multiple="true">
              <match class="class.ship"/>
              <match unit="false"/>
            </find_object>
            <do_if value="$_FoundPlayerShips.count gt 0">
              <do_for_each name="$_FoundPlayerShip" in="$_FoundPlayerShips">
                <do_if value="not (['JP_TradeSubscriptionExplorerV2G','JP_TradeSubscriptionExplorerV2S'].indexof.{@$_FoundPlayerShip.defaultorder.id})">
                  <substitute_text source="$_FoundPlayerShip.knownname" text="$_ResultName">
                    <replace string="('\033#FFA95908#' + '#TSEV2-S ' + '\033X')" with="''"/>
                    <replace string="('\033#FFA95908#' + '#TSEV2-G ' + '\033X')" with="''"/>
                    <replace string="('\033#FFA95908#' + ' #TSEV2-S' + '\033X')" with="''"/>
                    <replace string="('\033#FFA95908#' + ' #TSEV2-G' + '\033X')" with="''"/>
                  </substitute_text>
                  <do_if value="$_FoundPlayerShip.knownname != $_ResultName">
                    <set_object_name object="$_FoundPlayerShip" name="$_ResultName"/>
                  </do_if>
                </do_if>
              </do_for_each>
            </do_if>
            <remove_value name="$_FoundPlayerShips"/>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_SubscriptionsToUpdate_MD -->
        <cue name="JP_TSEV2_Manage_SubscriptionsToUpdate_MD" checkinterval="1s">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_SubscriptionsToUpdate_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$_TradeSubscriptionExplorerV2Ship" valuename="$_BlacklistedObject" in="global.$TradeSubscriptionExplorerV2Ships_Table">

                <do_if value="@$_BlacklistedObject == null">

                  <!-- ~~~~~~~~~~~~~~~~~~~~~~ -->
                  <do_if value="not $loctarget?">
                    <set_value name="$loctarget" exact="$_TradeSubscriptionExplorerV2Ship"/>
                  </do_if>
                  <do_if value="@$loctarget.isoperational">
                    <set_value name="$blacklistgroup" exact="blacklistgroup.civilian"/>
                    <do_if value="(@$loctarget.primarypurpose == purpose.fight) or (@$loctarget.primarypurpose == purpose.auxiliary)">
                      <set_value name="$blacklistgroup" exact="blacklistgroup.military"/>
                    </do_if>
                    <debug_text text="'%s %s %s %s belongs to blacklist group: %s'.[@$loctarget.class, @$loctarget.idcode, @$loctarget.knownname, $loctarget, $blacklistgroup]" chance="@$debugchance"/>
                  </do_if>
                  <do_else>
                    <debug_text text="'loctarget: %s %s %s %s is invalid or not operational.'.[@$loctarget.class, @$loctarget.idcode, @$loctarget.knownname, @$loctarget]" filter="error"/>
                  </do_else>
                  <remove_value name="$loctarget"/>
                  <!-- ~~~~~~~~~~~~~~~~~~~~~~ -->

                  <create_list name="$_Sectors"/>
                  <do_if value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$SECTOR?">
                    <append_to_list name="$_Sectors" exact="$_TradeSubscriptionExplorerV2Ship.defaultorder.$SECTOR"/>
                  </do_if>
                  <do_else>
                    <find_sector name="$_Sectors" space="player.galaxy" multiple="true">
                      <match knownto="$_TradeSubscriptionExplorerV2Ship.owner"/>
                      <match_gate_distance object="$_TradeSubscriptionExplorerV2Ship" min="0"/>
                      <match_use_blacklist object="$_TradeSubscriptionExplorerV2Ship" type="blacklisttype.sectortravel" group="$blacklistgroup"/>
                      <match_use_blacklist object="$_TradeSubscriptionExplorerV2Ship" type="blacklisttype.sectoractivity" group="$blacklistgroup"/>
                    </find_sector>
                  </do_else>

                  <do_if value="$DEBUG gt 0">
                    <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
                    <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'$_Sectors.count: ' + $_Sectors.count"/>
                    <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
                    <do_for_each name="$_Sector" in="$_Sectors">
                      <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'$_Sector: ' + $_Sector.knownname + ' ~ ' + $_TradeSubscriptionExplorerV2Ship.gatedistance.{$_Sector}"/>
                    </do_for_each>
                    <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
                  </do_if>

                  <set_value name="$_SubscriptionToUpdate" exact="null"/>
                  <do_if value="$_Sectors.count gt 0">

                    <do_if value="$_Sectors.count gt 1">
                      <sort_list list="$_Sectors" sortbyvalue="$_TradeSubscriptionExplorerV2Ship.gatedistance.{loop.element}"/>
                    </do_if>

                    <do_for_each name="$_Sector" in ="$_Sectors">
                      <create_list name="$_FoundObjects"/>

                      <find_station name="$_FoundObjects" space="$_Sector" multiple="true" append="true">
                        <match knownto="$_TradeSubscriptionExplorerV2Ship.owner"/>
                        <match tradesknownto="$_TradeSubscriptionExplorerV2Ship.owner" negate="true"/>
                        <match_use_blacklist object="$_TradeSubscriptionExplorerV2Ship" type="blacklisttype.sectortravel" group="$blacklistgroup"/>
                        <match_use_blacklist object="$_TradeSubscriptionExplorerV2Ship" type="blacklisttype.sectoractivity" group="$blacklistgroup"/>
                      </find_station>

                      <!-- Remove blacklisted -->
                      <do_if value="global.$TradeSubscriptionExplorerV2Blacklist_List?">
                        <remove_from_list name="$_FoundObjects" list="global.$TradeSubscriptionExplorerV2Blacklist_List"/>
                      </do_if>

                      <!-- Sort and get nearest -->
                      <do_if value="$_FoundObjects.count gt 0">
                        <do_if value="$_FoundObjects.count gt 1">
                          <sort_list list="$_FoundObjects" sortbyvalue="$_TradeSubscriptionExplorerV2Ship.distanceto.{loop.element}" sortdescending="true"/>
                        </do_if>
                        <do_if value="$DEBUG gt 0">
                          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
                          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'$_Sector.knownname: ' + $_Sector.knownname"/>
                          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'$_FoundObjects.count: ' + $_FoundObjects.count"/>
                          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
                          <do_for_each name="$_FoundObject" in="$_FoundObjects">
                            <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'$_FoundObject: ' + $_FoundObject.knownname + ' ~ ' + $_TradeSubscriptionExplorerV2Ship.distanceto.{$_FoundObject}"/>
                          </do_for_each>
                          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
                        </do_if>
                        <!-- Return value ~ $_SubscriptionToUpdate !! -->
                        <set_value name="$_SubscriptionToUpdate" exact="$_FoundObjects.last"/>
                        <break/>
                      </do_if>
                    </do_for_each>
                  </do_if>
                  <do_else>
                    <break/>
                  </do_else>
                  <set_value name="global.$TradeSubscriptionExplorerV2Ships_Table.{$_TradeSubscriptionExplorerV2Ship}" exact="$_SubscriptionToUpdate"/>
                  <remove_value name="$_FoundObjects"/>
                  <remove_value name="$_Sectors"/>
                  <break/>
                </do_if>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Handle_TSEV2Blacklist_List_MD -->
        <cue name="JP_TSEV2_Handle_TSEV2Blacklist_List_MD">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Handle_TSEV2Blacklist_List_MD'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$TradeSubscriptionExplorerV2Ship" valuename="$BlacklistedObject" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                <do_if value="@$BlacklistedObject != null and @global.$TradeSubscriptionExplorerV2Blacklist_List.indexof.{$BlacklistedObject} le 0">
                  <append_to_list name="global.$TradeSubscriptionExplorerV2Blacklist_List" exact="$BlacklistedObject"/>
                </do_if>
              </do_for_each>
            </do_if>

            <do_if value="@global.$TradeSubscriptionExplorerV2Blacklist_List.count gt 0">
              <do_for_each name="$TradeSubscriptionExplorerV2Blacklist_Entry" in="global.$TradeSubscriptionExplorerV2Blacklist_List" reverse="true">
                <set_value name="$_WasInList" exact="false"/>
                <do_for_each valuename="$_Entry" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                  <do_if value="$TradeSubscriptionExplorerV2Blacklist_Entry == $_Entry">
                    <set_value name="$_WasInList" exact="true"/>
                    <break/>
                  </do_if>
                </do_for_each>
                <do_if value="not $_WasInList">
                  <remove_from_list name="global.$TradeSubscriptionExplorerV2Blacklist_List" exact="$TradeSubscriptionExplorerV2Blacklist_Entry"/>
                </do_if>
                <remove_value name="$_WasInList"/>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_Exploring -->
        <cue name="JP_TSEV2_Manage_Exploring">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_Exploring'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$TradeSubscriptionExplorerV2Ship" valuename="$BlacklistedObject" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                <set_value name="$_ExploreWasInList" exact="false"/>
                <set_value name="$_IdleWasInList" exact="false"/>
                <do_for_each name="$_Order" in="$TradeSubscriptionExplorerV2Ship.orders">
                  <do_if value="$_Order.id == 'JP_ExploreTradeSubscription_TSEV2'">
                    <set_value name="$_ExploreWasInList" exact="true"/>
                  </do_if>
                  <do_if value="$_Order.id == 'JP_IdleReturnHome_TSEV2'">
                    <set_value name="$_IdleWasInList" exact="true"/>
                  </do_if>
                </do_for_each>
                <do_if value="$TradeSubscriptionExplorerV2Ship.orders.count == 0 or $_IdleWasInList and not $_ExploreWasInList and @$BlacklistedObject != null">
                  <cancel_all_orders object="$TradeSubscriptionExplorerV2Ship"/>
                  <create_order id="'JP_ExploreTradeSubscription_TSEV2'" object="$TradeSubscriptionExplorerV2Ship">
                    <param name="STATION" value="global.$TradeSubscriptionExplorerV2Ships_Table.{$TradeSubscriptionExplorerV2Ship}"/>
                    <param name="DEBUG_FOLDER_NAME" value="'JP_TradeSubscriptionExplorerV2.logs'"/>
                    <param name="DEBUG" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG"/>
                  </create_order>
                </do_if>
                <remove_value name="$_IdleWasInList"/>
                <remove_value name="$_ExploreWasInList"/>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_Idling -->
        <cue name="JP_TSEV2_Manage_Idling">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_Idling'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table.keys.list.count gt 0">
              <do_for_each name="$TradeSubscriptionExplorerV2Ship" valuename="$BlacklistedObject" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                <set_value name="$_WasInList" exact="false"/>
                <do_for_each name="$_Order" in="$TradeSubscriptionExplorerV2Ship.orders">
                  <do_if value="$_Order.id == 'JP_IdleReturnHome_TSEV2'">
                    <set_value name="$_WasInList" exact="true"/>
                    <break/>
                  </do_if>
                </do_for_each>
                <do_if value="not $_WasInList and @$BlacklistedObject == null">
                  <cancel_all_orders object="$TradeSubscriptionExplorerV2Ship"/>
                  <create_order id="'JP_IdleReturnHome_TSEV2'" object="$TradeSubscriptionExplorerV2Ship">
                    <param name="IDLE_TIME" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME"/>
                    <param name="IDLE_FOLLOW" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW"/>
                    <param name="WHO_TO_FOLLOW" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW"/>
                    <param name="IDLE_DOCKING" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING"/>
                    <param name="WHERE_TO_DOCK" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK"/>
                    <param name="IDLE_RANDOM_MOVEMENT" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT"/>
                    <param name="IN_WHICH_SECTOR" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR"/>
                    <param name="IDLE_MOVE_TO" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO"/>
                    <param name="WHERE_TO_MOVE" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE"/>
                    <param name="DEBUG_FOLDER_NAME" value="'JP_TradeSubscriptionExplorerV2.logs'"/>
                    <param name="DEBUG" value="$TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG"/>
                  </create_order>
                </do_if>
                <remove_value name="$_WasInList"/>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

        <!-- JP_TSEV2_Manage_Fleet -->
        <cue name="JP_TSEV2_Manage_Fleet">
          <actions>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <set_value name="$DEBUG" exact="0"/>
            <do_if value="$DEBUG gt 0">
              <set_value name="$DebugScriptName" exact="'JP_TSEV2_Manage_Fleet'"/>
              <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorerV2.logs'"/>
              <set_value name="$DebugFileName" exact="$DebugScriptName + '.xml.log'"/>
              <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Started ~~' + '\n'"/>
            </do_if>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

            <do_if value="global.$TradeSubscriptionExplorerV2Ships_Table? and @global.$TradeSubscriptionExplorerV2Ships_Table != null">
              <do_for_each name="$_TradeSubscriptionExplorerV2Ship" in="global.$TradeSubscriptionExplorerV2Ships_Table">
                <do_if value="['JP_TradeSubscriptionExplorerV2G','JP_TradeSubscriptionExplorerV2S'].indexof.{@$_TradeSubscriptionExplorerV2Ship.defaultorder.id}">
                  <substitute_text source="$_TradeSubscriptionExplorerV2Ship.fleet.name" text="$_FleetName">
                    <replace string="'TradeSubscriptionExplorerV2_Fleet'" with="''"/>
                  </substitute_text>
                  <do_if value="$_TradeSubscriptionExplorerV2Ship.fleet.name != $_FleetName">
                    <do_for_each name="$_Subordinate" in="$_TradeSubscriptionExplorerV2Ship.subordinates">
                      <do_if value="$_Subordinate.isunit">
                        <continue/>
                      </do_if>
                      <do_if value="$_Subordinate.defaultorder.id != $_TradeSubscriptionExplorerV2Ship.defaultorder.id or $_Subordinate.assignment != assignment.assist">
                        <set_object_commander object="$_Subordinate" commander="$_TradeSubscriptionExplorerV2Ship" assignment="assignment.assist"/>
                        <create_order object="$_Subordinate" id="$_TradeSubscriptionExplorerV2Ship.defaultorder.id" default="true">
                          <param name="IDLE" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE"/>
                          <param name="IDLE_TIME" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME"/>
                          <param name="IDLE_FOLLOW" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW"/>
                          <param name="WHO_TO_FOLLOW" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW"/>
                          <param name="IDLE_DOCKING" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING"/>
                          <param name="WHERE_TO_DOCK" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK"/>
                          <param name="IDLE_RANDOM_MOVEMENT" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT"/>
                          <param name="IN_WHICH_SECTOR" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR"/>
                          <param name="IDLE_MOVE_TO" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO"/>
                          <param name="WHERE_TO_MOVE" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE"/>
                          <param name="ADD_ORDER_TAG" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG"/>
                          <param name="ORDER_TAG_POSITION" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION"/>
                          <param name="DEBUG" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG"/>
                        </create_order>
                      </do_if>
                      <do_else>
                        <do_if value="$_Subordinate.defaultorder.$IDLE != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IDLE_TIME != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE_TIME'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_TIME"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IDLE_FOLLOW != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE_FOLLOW'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_FOLLOW"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$WHO_TO_FOLLOW != $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'WHO_TO_FOLLOW'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHO_TO_FOLLOW"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IDLE_DOCKING != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE_DOCKING'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_DOCKING"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$WHERE_TO_DOCK != $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'WHERE_TO_DOCK'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_DOCK"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IDLE_RANDOM_MOVEMENT != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE_RANDOM_MOVEMENT'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_RANDOM_MOVEMENT"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IN_WHICH_SECTOR != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IN_WHICH_SECTOR'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IN_WHICH_SECTOR"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$IDLE_MOVE_TO != $_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'IDLE_MOVE_TO'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$IDLE_MOVE_TO"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$WHERE_TO_MOVE != $_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'WHERE_TO_MOVE'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$WHERE_TO_MOVE"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$ADD_ORDER_TAG != $_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'ADD_ORDER_TAG'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$ADD_ORDER_TAG"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$ORDER_TAG_POSITION != $_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'ORDER_TAG_POSITION'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$ORDER_TAG_POSITION"/>
                        </do_if>
                        <do_if value="$_Subordinate.defaultorder.$DEBUG != $_TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG">
                          <edit_order_param order="$_Subordinate.defaultorder" param="'DEBUG'" value="$_TradeSubscriptionExplorerV2Ship.defaultorder.$DEBUG"/>
                        </do_if>
                      </do_else>
                    </do_for_each>
                    <set_value name="$_FleetName" exact="'\033#FF03A1FC#' + 'TradeSubscriptionExplorerV2_Fleet' + '\033X'"/>
                    <do_if value="$_TradeSubscriptionExplorerV2Ship.fleet.name != $_FleetName">
                      <set_object_fleet_name object="$_TradeSubscriptionExplorerV2Ship" name="$_FleetName"/>
                    </do_if>
                  </do_if>
                </do_if>
              </do_for_each>
            </do_if>

            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
            <do_if value="$DEBUG gt 0">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ ' + $DebugScriptName + '.xml ~ Finished ~~'"/>
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
              <remove_value name="$DebugFileName"/>
              <remove_value name="$DebugFolderName"/>
              <remove_value name="$DebugScriptName"/>
            </do_if>
            <remove_value name="$DEBUG"/>
            <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

          </actions>
        </cue>

      </cues>
    </cue>

  </cues>
</mdscript>