<?xml version="1.0" encoding="utf-8" ?>

<mdscript name="JP_UpdateTradeSubscriptionExplorerFleet_MD" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
  <cues>

    <cue name="JP_UPDATE_TRADE_SUBSCRIPTION_EXPLORER_FLEET" instantiate="true" checkinterval="2s">
      <conditions>
        <check_value value="global.$TradeSubscriptionExplorerShips? and @global.$TradeSubscriptionExplorerShips.count gt 1"/>
      </conditions>
      <actions>

        <set_value name="$DEBUG" exact="0"/>
        <do_if value="$DEBUG">
          <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorer.logs'"/>
          <set_value name="$DebugFileName" exact="'JP_UPDATE_TRADE_SUBSCRIPTION_EXPLORER_FLEET.xml.log'"/>
        </do_if>

        <do_if value="$DEBUG">
          <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ JP_UPDATE_TRADE_SUBSCRIPTION_EXPLORER_FLEET.xml ~ Started ~~' + '\n'"/>
        </do_if>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_for_each name="$_AutoFleetShip" in="global.$TradeSubscriptionExplorerShips">
          <do_if value="$_AutoFleetShip.defaultorder.$IS_AUTO_FLEET_LEADER and $_AutoFleetShip.defaultorder.$AUTO_FLEET">
            <set_value name="$_AutoFleetShipLeader" exact="$_AutoFleetShip"/>
            <continue/>
          </do_if>
        </do_for_each>

        <do_if value="$_AutoFleetShipLeader?">
          <do_for_each name="$_AutoFleetShip" in="global.$TradeSubscriptionExplorerShips" counter="$_it">
            <do_if value="not $_AutoFleetShip.defaultorder.$AUTO_FLEET">
              <continue/>
            </do_if>
            <do_if value="$_AutoFleetShip != $_AutoFleetShipLeader and $_AutoFleetShip.commander == null">
              <set_object_commander object="$_AutoFleetShip" commander="$_AutoFleetShipLeader"/>
              <continue/>
            </do_if>
            <do_if value="$_AutoFleetShip == $_AutoFleetShipLeader and $_AutoFleetShip.fleet.name != ''">
              <set_value name="$_ColorString" exact="if @global.$TSE_AFCS then global.$TSE_AFCS else ''"/>
              <do_if value="$_AutoFleetShip.fleet.name != (if $_ColorString == '' then 'TradeSubscriptionExplorer' else $_ColorString + 'TradeSubscriptionExplorer' + '\033X')">
                <set_object_fleet_name object="$_AutoFleetShip" name="if $_ColorString != '' then $_ColorString + 'TradeSubscriptionExplorer' + '\033X' else 'TradeSubscriptionExplorer'"/>
              </do_if>
              <remove_value name="$_ColorString"/>
              <continue/>
            </do_if>
          </do_for_each>
        </do_if>

        <do_if value="$_AutoFleetShipLeader?">
          <remove_value name="$_AutoFleetShipLeader"/>
        </do_if>

        <!-- TODO: Remove -->
        <do_if value="1">
          <remove_value name="global.$TradeSubscriptionExplorerFleetLeader"/>
          <remove_value name="global.$TradeSubscriptionExplorerAutoFleetNameColorString"/>
        </do_if>
        <!-- TODO: Remove -->

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ JP_UPDATE_TRADE_SUBSCRIPTION_EXPLORER_FLEET.xml ~ Finished ~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
        </do_if>

        <do_if value="$DEBUG">
          <remove_value name="$DebugFileName"/>
          <remove_value name="$DebugFolderName"/>
        </do_if>
        <remove_value name="$DEBUG"/>

      </actions>
    </cue>

    <cue name="JP_TRADE_SUBSCRIPTION_EXPLORER_DEBUG" instantiate="false" checkinterval="1s">
      <actions>

        <set_value name="$DEBUG" exact="1"/>
        <do_if value="$DEBUG">
          <set_value name="$DebugFolderName" exact="'JP_TradeSubscriptionExplorer.logs'"/>
          <set_value name="$DebugFileName" exact="'JP_TRADE_SUBSCRIPTION_EXPLORER_DEBUG.xml.log'"/>
        </do_if>

        <do_if value="$DEBUG">
          <debug_to_file append="false" directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ JP_TRADE_SUBSCRIPTION_EXPLORER_DEBUG.xml ~ Started ~~' + '\n'"/>
        </do_if>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'global.$TradeSubscriptionExplorerSectorBlackList'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <do_if value="global.$TradeSubscriptionExplorerSectorBlackList?">
            <do_for_each name="$_Sector" in="@global.$TradeSubscriptionExplorerSectorBlackList">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Sector: %1 ~~ [%2].'.[@$_Sector.knownname, @$_Sector.owner.knownname]"/>
            </do_for_each>
          </do_if>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>

          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'global.$TradeSubscriptionExplorerShips'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'"/>
          <do_if value="global.$TradeSubscriptionExplorerShips?">
            <do_for_each name="$_Ship" in="@global.$TradeSubscriptionExplorerShips">
              <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~ Ship: %1 [%2] ~~ [%3].'.[@$_Ship.knownname, @$_Ship.idcode, @$_Ship.owner.knownname]"/>
            </do_for_each>
          </do_if>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
        </do_if>

        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

        <do_if value="$DEBUG">
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'[' + player.systemtime.{'%F - %X'} + '] ' + '~~ JP_TRADE_SUBSCRIPTION_EXPLORER_DEBUG.xml ~ Finished ~~'"/>
          <debug_to_file directory="$DebugFolderName" name="$DebugFileName" text="'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n'"/>
        </do_if>

        <do_if value="$DEBUG">
          <remove_value name="$DebugFileName"/>
          <remove_value name="$DebugFolderName"/>
        </do_if>
        <remove_value name="$DEBUG"/>

      </actions>
    </cue>

  </cues>
</mdscript>